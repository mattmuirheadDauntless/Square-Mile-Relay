$(function(){function e(){$.get("/news/p"+c,function(e){if(e.indexOf("no-results")>=0)$(".loading-icon").addClass("hide"),m=1;else{var t=$(""+e);r.append(t).isotope("appended",t),r.imagesLoaded().progress(function(){r.isotope("layout")})}}).done(function(){c++,0==m&&e()})}function t(){$.get("/companies/p"+c,function(e){if(e.indexOf("no-results")>=0)$(".loading-icon").addClass("hide"),m=1;else{var t=$(""+e);u.append(t).isotope("appended",t),u.imagesLoaded().progress(function(){u.isotope("layout")})}}).done(function(){c++,0==m&&t()})}function a(){$.get("/results/teams/p"+c,function(e){e.indexOf("no-results")>=0?($(".loading-icon").addClass("hide"),m=1):$teamResultsTable.append(e)}).done(function(){c++,$(".filter.active").trigger("click"),0==m&&a()})}function i(){$.get("/results/individuals/p"+c,function(e){e.indexOf("no-results")>=0?($(".loading-icon").addClass("hide"),m=1):$individualResultsTable.append(e)}).done(function(){c++,$(".filter.active").trigger("click"),0==m&&i()})}function s(){$.get("/gallery/p"+c,function(e){if(e.indexOf("no-results")>=0)$(".loading-icon").addClass("hide"),m=1;else{var t=$(""+e);g.append(t).isotope("appended",t),g.imagesLoaded().progress(function(){g.isotope("layout")}),$(".img-item.ajax-item").each(function(){var e=$(this),t=e.attr("data-src"),a=e.attr("data-caption"),i=$('<div class="img-cell"><img data-flickity-lazyload="'+t+'"><br><p class="caption">'+a+"</p></div>");n.flickity("append",i),e.removeClass("ajax-item")}),$(".slider-modal-link").click(function(){var e=$(this),t=$(".slider-modal-link").index(this);$(".media-modal .img").addClass("hide"),$(".media-modal .video").addClass("hide"),$(".media-modal .slider").removeClass("hide"),n.flickity("select",t)})}}).done(function(){c++,0==m&&s()})}function l(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),i=a.exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}if($("#ctaBanner").length>0&&new Waypoint({element:$("#ctaBanner"),handler:function(){$("body").toggleClass("cta-fixed")},offset:function(){return-this.element.height()}}),new Waypoint({element:$("body"),handler:function(){$(".header").toggleClass("fixed-header")},offset:-60}),$(".menu-btn").click(function(){$("body").toggleClass("menu-open"),$(".has-child").removeClass("active")}),$(".nav .has-child").hover(function(){$(".header").addClass("fixed-logo")},function(){$(".header").removeClass("fixed-logo")}),$(".nav .has-child").click(function(){$(".has-child").toggleClass("active")}),$("input").on("input",function(){1==$(this).is(":valid")?$(this).removeClass("invalid").addClass("valid"):$(this).removeClass("valid").addClass("invalid")}),$("#dateOfBirth").datepicker({format:"dd/mm/yyyy",autoclose:!0,startView:2}),$('a[href="#contact"]').click(function(e){e.preventDefault(),$("#contactBtn").trigger("click")}),$(".filters .filters-btn").click(function(){$(".filters").toggleClass("active")}),$(".filter").click(function(){var e=$(this),t=e.parent(".filter-group"),a=e.attr("data-filter");if("*"==a)$(".filter").removeClass("active"),e.addClass("active");else if(a="",t.children(".filter").removeClass("active"),e.addClass("active"),$(".filter.active").each(function(){a+=$(this).attr("data-filter")}),$(".filter.active:not(.btn)").length>1){var i=$(".filter-group.large .filter.active").attr("data-filter").replace(".",""),s=$(".filter-group.small .filter.active").attr("data-filter").replace(".","");a="."+i+"-"+s}if($(".isotope-no-items").addClass("inactive"),$(".news").length>0&&$(".news").isotope({filter:a}),$(".charities").length>0&&$(".charities").isotope({filter:a}),$(".companies").length>0&&$(".companies").isotope({filter:a}),$(".partners").length>0){var l=e.attr("data-latest-event");$(".partners .race").addClass("hide"),$(".partners .race"+a).removeClass("hide"),$(".partners .race").removeClass("fixed"),$(".filter-group.small .filter.active").length<=0&&(""!=l?$('.filter-group.small .filter[data-filter=".'+l+'"]').trigger("click"):$(".filter-group.small .filter:first-child").trigger("click")),$(".filter-group.large .filter.active").length<=0&&$(".filter-group.large .filter:first-child").trigger("click"),$("a[href*=\\#]:not(.link)").click(function(e){e.preventDefault(),$("html,body").animate({scrollTop:$($.attr(this,"href")).offset().top-170},500)}),$(".slide-nav-section").each(function(){var e=$(this),t=e.attr("id"),a=e.attr("data-slide"),i=$("#"+t).offset().top+250;$(window).scroll(function(){$(window).scrollTop()+p<=i&&$(window).scrollTop()+v>=i&&(console.log(i),i>7500?$(".slide-nav").css("margin-top","-500px"):i>6500?$(".slide-nav").css("margin-top","-400px"):i>5500?$(".slide-nav").css("margin-top","-300px"):i>4500?$(".slide-nav").css("margin-top","-200px"):i>3500?$(".slide-nav").css("margin-top","-100px"):$(".slide-nav").css("margin-top","0px"),$(".slide-nav li").each(function(){$(this).removeClass("active")}),$("."+t).addClass("active"))})}),$(".race.active").each(function(){var e=$(this),t=e.offset().top;$(window).scroll(function(){$(window).scrollTop()+140>=t?e.addClass("fixed"):e.removeClass("fixed")})})}return $(".gallery-grid").length>0&&$(".gallery-grid").isotope({filter:a}),$(".results-table").length>0&&($(".results-table tbody tr").addClass("hide"),$(".results-table tbody tr"+a).removeClass("hide"),setTimeout(function(){$(".results-table table tr:visible").length<=0&&($(".results-table").height($(".isotope-no-items").height()+200),$(".isotope-no-items").removeClass("inactive"))},500)),$(".company-table").length>0&&($(".company-table tr").addClass("hide"),$(".company-table tr"+a).removeClass("hide"),setTimeout(function(){$(".company-table tr:visible").length<=0&&($(".table-wrapper").height($(".isotope-no-items").height()+200),$(".isotope-no-items").removeClass("inactive"))},500)),$(".faqs").length>0&&($(".faq").addClass("hide"),$(".faq"+a).removeClass("hide")),!1}),$(".tablesorter").tablesorter(),$(".notification .close").click(function(){$(this).parent(".notification").addClass("hide")}),$(".vid-modal-link").click(function(){var e=$(this),t=e.attr("data-src");$(".media-modal .img").addClass("hide"),$(".media-modal .video").removeClass("hide"),$(".media-modal .slider").addClass("hide"),$("#videoiFrame").attr("src",t)}),$(".img-modal-link").click(function(){var e=$(this),t=e.attr("data-src"),a=e.attr("data-caption");$(".media-modal .img").removeClass("hide"),$(".media-modal .video").addClass("hide"),$(".media-modal .slider").addClass("hide"),a.length>0&&($(".media-modal .img p").removeClass("hide"),$(".media-modal .img p").text(a)),$(".media-modal .img img").attr("src",t),$(".loading-icon").remove()}),$(".img-slider").length>0)var n=$(".img-slider").flickity({cellSelector:".img-cell",setGallerySize:!1,cellAlign:"left",wrapAround:!0,percentPosition:!0,lazyLoad:!0,pageDots:!0});if($(".slider-modal-link").length>0&&$(".img-item").each(function(){var e=$(this),t=e.attr("data-src"),a=e.attr("data-caption"),i=$('<div class="img-cell"><img data-flickity-lazyload="'+t+'"><br><p class="caption">'+a+"</p></div>");n.flickity("append",i)}),$(".slider-modal-link").click(function(){var e=$(this),t=$(".slider-modal-link").index(this);$(".media-modal .img").addClass("hide"),$(".media-modal .video").addClass("hide"),$(".media-modal .slider").removeClass("hide"),n.flickity("select",t)}),$(".modal .close").click(function(){$("#videoiFrame").attr("src","")}),$("form input[type=submit]").keydown(function(e){9==e.keyCode&&(e.preventDefault(),$(this).parent().find("*:input[type!=hidden]:first").focus())}),$(".enter-race-modal").click(function(){var e=$(this),t=e.attr("data-city");if(console.log("I work like wind."),void 0!=t&&t.length>0){$("#enterRaceLocation").val(t),$(".slide[data-slide=1] .next").trigger("click");var a=$("body").data("locale");a=void 0==a||void 0!=a&&a.length<=0?"":"en_gb"==a?"":"/"+a,$(".slide[data-city="+t+"] #enterRaceFrame").attr("src",a+"/commerce/products?city="+t)}}),$(".slide .next").click(function(){var e=$(this),t=e.parent(".slide").attr("data-slide"),a=parseFloat(t,2)+1,i=$("#enterRaceLocation").val();$(".slide.country").addClass("hidden"),$(".slide.country[data-city="+i+"]").removeClass("hidden"),e.parent(".slide").addClass("completed"),e.parent(".slide").removeClass("current"),$('.slide[data-slide="'+a+'"]').addClass("current"),$('.stages li[data-slide="'+t+'"]').addClass("completed"),$('.stages li[data-slide="'+t+'"]').removeClass("current"),$('.stages li[data-slide="'+a+'"]').addClass("current"),$(".stages ul").removeClass(),$(".stages ul").addClass("stage-"+a)}),$(".stages ul li").click(function(){var e=$(this),t=e.attr("data-slide");$currentSlide=$(".slide.current").attr("data-slide"),e.hasClass("completed")&&($('.slide[data-slide="'+$currentSlide+'"]').removeClass("completed"),$('.slide[data-slide="'+$currentSlide+'"]').removeClass("current"),$('.slide[data-slide="'+t+'"]').removeClass("completed"),$('.slide[data-slide="'+t+'"]').addClass("current"),$('.stages li[data-slide="'+$currentSlide+'"]').removeClass("completed"),$('.stages li[data-slide="'+$currentSlide+'"]').removeClass("current"),$('.stages li[data-slide="'+t+'"]').removeClass("completed"),$('.stages li[data-slide="'+t+'"]').addClass("current"),$(".stages ul").removeClass(),$(".stages ul").addClass("stage-"+t))}),$(".finish-payment").click(function(){var e=$("#enterRaceFrame",window.parent.document).parent().parent().parent().parent().parent(),t=$(this).attr("data-user-id");e.find(".slide.country[data-slide=2]:not(.hidden)").addClass("completed"),e.find(".slide.country[data-slide=2]:not(.hidden)").removeClass("current"),e.find(".slide[data-slide=3]").addClass("current"),e.find(".modal-footer ul").removeClass(),e.find(".modal-footer ul").addClass("stage-3"),e.find(".modal-footer ul li[data-slide=2]").removeClass(),e.find(".modal-footer ul li[data-slide=2]").addClass("completed"),e.find(".modal-footer ul li[data-slide=3]").addClass("current"),e.find("#reasonUserID").val(t)}),$(".send-to-my-account").click(function(){var e=$(this),t=e.attr("data-href");window.parent.document.location.href=t}),$(".send-to-forgot-password").click(function(){window.parent.document.location.href="/forgot-password"}),$(".back-to-cities").click(function(){var e=$("#enterRaceFrame",window.parent.document).parent().parent().parent().parent().parent();e.find(".slide[data-slide=1]").removeClass("completed"),e.find(".slide[data-slide=1]").addClass("current"),e.find(".slide.country[data-slide=2]:not(.hidden)").removeClass("current"),e.find(".modal-footer ul").removeClass(),e.find(".modal-footer ul").addClass("stage-1"),e.find(".modal-footer ul li[data-slide=2]").removeClass(),e.find(".modal-footer ul li[data-slide=1]").addClass("current"),$("#emptyCart").trigger("click")}),$("#newCompany").on("change",function(){$(".new-company-name").toggleClass("hide")}),$(".next-races").length>0)var o=$(".races").flickity({cellSelector:".race",cellAlign:"left",wrapAround:!0,groupCells:"100%",prevNextButtons:!1});$("#viewMoreRaces").click(function(){o.flickity("next")}),$(".about-accordion").length>0&&$(window).width()>900&&new Waypoint({element:$("#aboutAccordion"),handler:function(){$(".nav-item").toggleClass("fixed")},offset:"127px"}),$(".about-accordion .nav-items .nav-item").click(function(){var e=$(this),t=e.attr("data-accordion");console.log("test2"),setTimeout(function(){$(".gallery-grid").isotope("layout")},500),$(window).width()>900?($(".about-accordion .nav-items .nav-item").removeClass("active"),$(".about-accordion .main-accordion").removeClass("active"),e.addClass("active"),$('.about-accordion .main-accordion[data-accordion="'+t+'"]').addClass("active"),$("html,body").animate({scrollTop:$(".about-accordion").offset().top-130},500)):(e.toggleClass("active"),$('.about-accordion .main-accordion[data-accordion="'+t+'"]').toggleClass("active"))});var d=$(".accordion-gallery").isotope({layoutMode:"packery",itemSelector:".img-item"});d.imagesLoaded().progress(function(){d.isotope("layout")}),$(".next-accordion").click(function(){var e=$(this),t=e.attr("data-accordion");$(".nav-item[data-accordion="+t+"]").trigger("click")}),$(".race-locations .cities li").click(function(){var e=$(this),t=e.attr("data-city");$(".race-locations .cities li").removeClass("active"),e.addClass("active"),$(".race-locations .city").removeClass("active"),$(".race-locations .city").each(function(){$(this).attr("data-city")==t&&$(this).addClass("active")})}),$(".race-locations .city .timer").each(function(){var e=$(this),t=e.attr("data-date");e.countdown(t,function(t){e.text(t.strftime("%D:%H:%M:%S"))})});var r=$(".news").isotope({itemSelector:".news-item",percentPosition:!0,layoutMode:"fitRows"});if(r.imagesLoaded().progress(function(){r.isotope("layout")}),r.length){var c=2,m=0;e()}$(".related-articles-slider").flickity({cellAlign:"left",pageDots:!1,prevNextButtons:!1,contain:!0,wrapAround:!0,autoPlay:8e3});var f=$(".charities").isotope({itemSelector:".charities-item",percentPosition:!0,layoutMode:"fitRows"});f.imagesLoaded().progress(function(){f.isotope("layout")});var u=$(".companies").isotope({itemSelector:".companies-item",percentPosition:!0,layoutMode:"fitRows"});if(u.imagesLoaded().progress(function(){u.isotope("layout")}),u.length){var c=2,m=0;t()}if($teamResultsTable=$(".results-table.results-teams table tbody"),$teamResultsTable.length){var c=2,m=0;a()}if($individualResultsTable=$(".results-table.results-individuals table tbody"),$individualResultsTable.length){var c=2,m=0;i()}$(".tablesorter").tablesorter(),$(".edit-btn").click(function(){$(".my-profile").addClass("edit")}),$(".save-btn").click(function(){var e=0;$(".required").each(function(){(""==$(this).find("input").val()||$(".input").hasClass("invalid"))&&(e=1)})}),$(".btn-invite-member, .resend").click(function(e){e.preventDefault();var t=$(this);t.attr("disabled","disabled"),t.text("please wait"),$teamId=$('#update-team-members input[name="teamId"]').val(),$firstName=t.parent().parent().find("#firstName").val(),$lastName=t.parent().parent().find("#lastName").val(),$email=t.parent().parent().find("#email").val(),$email.length>0&&$.post("/",{action:"squareMileRelay/teamMembers/addTeamMember",firstName:$firstName,lastName:$lastName,email:$email,teamId:$teamId},function(e,t,a){e.includes("Sorry")?alert(e):location.reload()})}),$(".btn-remove-member").click(function(e){var t=$(this),a=t.data("user-id"),i=t.data("team-id");$.post("/",{action:"squareMileRelay/teamMembers/removeTeamMember",userId:a,teamId:i},function(e,a,i){t.parent("td").parent("tr").find(".input").val(""),t.parent("td").parent("tr").find(".user-status").removeClass("confirmed"),t.parent("td").parent("tr").find(".user-status").removeClass("pending"),t.parent("td").parent("tr").find(".user-status").html('<button type="submit" class="btn btn-orange btn-tiny">Send Invitation</button>'),t.parent("td").parent("tr").find(".resend").remove(),t.remove()})});var p=70,v=$(window).height()/5+500;$(".race.active").each(function(){var e=$(this),t=e.offset().top;$(window).scroll(function(){$(window).scrollTop()+140>=t?e.addClass("fixed"):e.removeClass("fixed")})});var g=$(".gallery-grid").isotope({itemSelector:".grid-item",percentPosition:!0,layoutMode:"masonry",stamp:".stamp"});if(g.imagesLoaded().progress(function(){g.isotope("layout")}),g.length&&!g.hasClass("no-ajax")){var c=2,m=0;s()}$(".city-cta .close").click(function(){$(this).parent(".city-cta").addClass("hide")}),$("#citySlideNav").length>0&&(new Waypoint({element:$("#citySlideNav"),handler:function(){$("#citySlideNav").toggleClass("fixed")},offset:"180px"}),$("a[href*=\\#]:not(.link)").click(function(e){console.log("test"),e.preventDefault();var t=$($.attr(this,"href")).offset();void 0!=t&&$("html,body").animate({scrollTop:t.top-170},500)})),$(".race-year .section").each(function(){var e=$(this),t=e.attr("id"),a=e.attr("data-slide");new Waypoint({element:$("#"+t),handler:function(){$(".race-year .section").removeClass("active"),$("#"+t).addClass("active"),$(".slide-nav li").removeClass("active"),$(".slide-nav li[data-slide="+a+"]").addClass("active")},offset:"280px"})}),$(".company-table .heading-row").click(function(){var e=$(this),t=e.next(".child-row").find(".table-expander");e.toggleClass("active"),t.toggleClass("active")}),$(".faqs").length>0&&$("ul.filter-group>li:first-child").trigger("click");var h=function(){var e=0;return function(t,a){clearTimeout(e),e=setTimeout(t,a)}}();$enterRace=$("#enterRace");var C=l("city");if(console.log("city: 2"+C),$enterRace.find("select").on("change",function(){if($(this).val().length>0){$enterRace.find("div.next").removeClass("btn-invalid"),$enterRace.find("div.next").addClass("btn-orange");var e=$("body").data("locale");e=void 0==e||void 0!=e&&e.length<=0?"":"en_gb"==e?"":"/"+e,$(".slide[data-city="+$(this).val()+"] #enterRaceFrame").attr("src",e+"/commerce/products?city="+$(this).val()),C=$(this).val()}}),$("#terms").on("click",function(){if($(this).is(":checked")){var e=$(this).parent().parent().find(".btn-continue");e.removeClass("btn-invalid"),e.addClass("btn-orange")}else{var e=$(this).parent().parent().find(".btn-continue");e.addClass("btn-invalid"),e.removeClass("btn-orange")}}),$("#terms").is(":checked")){var y=$(this).parent().parent().find(".btn-continue");y.removeClass("btn-invalid"),y.addClass("btn-orange")}else{var y=$(this).parent().parent().find(".btn-continue");y.addClass("btn-invalid"),y.removeClass("btn-orange")}$(".terms input").each(function(){$(this).is(":checked")&&$(this).prop("checked",!1)}),$(".language-select").on("change",function(){window.location.href=$(this).val()})});